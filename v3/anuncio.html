<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>An√∫ncio | RePhone</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    :root { --dark: #0f172a; --green: #16a34a; --bg: #f8fafc; --muted: #64748b; }
    * { margin:0; padding:0; box-sizing:border-box; font-family:'Inter', sans-serif; }
    body { background: var(--bg); padding: 20px; }
    .btn-back { display:inline-block; margin-bottom:20px; text-decoration:none; color:var(--muted); font-size:12px; font-weight:800; }
    .panel { background: white; border-radius: 25px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
    .gallery img { width: 100%; border-radius: 15px; aspect-ratio:1/1; object-fit:cover; }
    h1 { font-size: 24px; font-weight: 900; margin: 15px 0 5px; }
    .distancia { font-size: 11px; color: var(--green); font-weight: 800; text-transform:uppercase; margin-bottom: 15px; }
    .price { font-size: 28px; font-weight: 900; color: var(--green); margin-bottom: 20px; }
    .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
    .info-box { background: #f8fafc; padding: 12px; border-radius: 12px; border: 1px solid #e2e8f0; }
    .info-box small { font-size: 9px; color: var(--muted); text-transform: uppercase; font-weight: 800; display: block; }
    .info-box span { font-size: 13px; font-weight: 700; }
    .stars { color: #facc15; font-size: 14px; margin-top: 5px; }
    .btn-zap { display: block; width: 100%; background: #25d366; color: white; text-align: center; padding: 18px; border-radius: 15px; text-decoration: none; font-weight: 900; font-size: 16px; margin-top: 15px; }
  </style>
</head>
<body>

  <a href="index.html" class="btn-back">‚Üê VOLTAR AO RADAR</a>

  <div class="panel" id="mainPanel" style="display:none;">
    <div class="gallery"><img id="pImg" src=""></div>
    <h1 id="pModelo">---</h1>
    <div class="distancia" id="pDist">Calculando dist√¢ncia...</div>
    <div class="price" id="pPreco">R$ ---</div>

    <div class="info-grid">
        <div class="info-box"><small>Capacidade</small><span id="pCap">--</span></div>
        <div class="info-box"><small>Bateria</small><span id="pBat">--</span>%</div>
        <div class="info-box"><small>Condi√ß√£o</small><span id="pCon">--</span></div>
        <div class="info-box"><small>Vendedor</small><span id="pTipo">--</span></div>
    </div>

    <div style="background:#fffef0; padding:15px; border-radius:15px; border:1px solid #fde68a;">
        <b style="font-size:11px; display:block;">REPHONE MATCH SCORE:</b>
        <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ <span style="color:var(--muted); font-size:10px;">(Pre√ßo justo p/ regi√£o)</span></div>
    </div>

    <a href="" id="pZap" target="_blank" class="btn-zap">CHAMAR NO WHATSAPP</a>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

    const firebaseConfig = { apiKey: "AIzaSyBiN8FqX8UZeyAh1cG2GHZtQWiQH0xPBV4", authDomain: "rephone-a0a80.firebaseapp.com", projectId: "rephone-a0a80", storageBucket: "rephone-a0a80.firebasestorage.app", messagingSenderId: "431497247030", appId: "1:431497247030:web:a943715e4acc04b8995b97" };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const id = new URLSearchParams(window.location.search).get('id');

    async function load() {
      const snap = await getDoc(doc(db, "anuncios", id));
      if (snap.exists()) {
        const ad = snap.data();
        document.getElementById('pImg').src = ad.fotos[0];
        document.getElementById('pModelo').innerText = ad.modelo;
        document.getElementById('pPreco').innerText = `R$ ${ad.preco}`;
        document.getElementById('pCap').innerText = ad.capacidade;
        document.getElementById('pBat').innerText = ad.bateria;
        document.getElementById('pCon').innerText = ad.condicao;
        document.getElementById('pTipo').innerText = ad.tipo || 'Particular';
        document.getElementById('pZap').href = `https://wa.me/55${ad.whatsapp}?text=Interesse no ${ad.modelo}`;
        
        const vSnap = await getDoc(doc(db, "vendedores", ad.uid));
        if (vSnap.exists() && vSnap.data().coords) calcDist(vSnap.data().coords);
        document.getElementById('mainPanel').style.display = 'block';
      }
    }

    function calcDist(vCoords) {
      navigator.geolocation.getCurrentPosition(pos => {
        const [la1, lo1] = vCoords.split(',').map(Number);
        const [la2, lo2] = [pos.coords.latitude, pos.coords.longitude];
        const R = 6371;
        const dLa = (la2-la1)*Math.PI/180; const dLo = (lo2-lo1)*Math.PI/180;
        const a = Math.sin(dLa/2)**2 + Math.cos(la1*Math.PI/180)*Math.cos(la2*Math.PI/180)*Math.sin(dLo/2)**2;
        const dist = R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        document.getElementById('pDist').innerText = `üìç Aprox. ${dist.toFixed(1)} km de voc√™`;
      });
    }
    load();
  </script>
</body>
</html>
