<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Detalhes do Aparelho | RePhone</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    :root { --dark: #0f172a; --green: #16a34a; --bg: #f8fafc; --muted: #64748b; }
    * { margin:0; padding:0; box-sizing:border-box; font-family:'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
    body { background: var(--bg); padding: 15px; line-height: 1.4; color: var(--dark); }

    .header-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
    .btn-back { text-decoration: none; color: var(--muted); font-size: 13px; font-weight: 800; text-transform: uppercase; }
    .distancia-top { font-size: 11px; font-weight: 900; color: var(--green); background: #dcfce7; padding: 5px 10px; border-radius: 20px; }

    .panel { background: white; border-radius: 30px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); width: 100%; }
    .gallery img { width: 100%; border-radius: 22px; aspect-ratio: 1/1; object-fit: cover; border: 1px solid #f1f5f9; }
    
    .badge-tipo { display: inline-block; background: #f1f5f9; padding: 6px 12px; border-radius: 8px; font-size: 10px; font-weight: 800; text-transform: uppercase; margin-top: 15px; color: var(--muted); }
    
    h1 { font-size: 26px; font-weight: 900; margin: 10px 0 5px; letter-spacing: -1px; line-height: 1.1; }
    .price { font-size: 32px; font-weight: 900; color: var(--green); margin-bottom: 20px; display: block; }

    .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
    .info-box { background: #f8fafc; padding: 15px; border-radius: 18px; border: 1px solid #e2e8f0; }
    .info-box small { font-size: 9px; color: var(--muted); text-transform: uppercase; font-weight: 800; display: block; margin-bottom: 2px; }
    .info-box span { font-size: 14px; font-weight: 700; }

    /* NOVO CAMPO: DESCRI√á√ÉO */
    .desc-box { margin-top: 20px; padding-top: 20px; border-top: 1px solid #f1f5f9; }
    .desc-box h4 { font-size: 11px; font-weight: 900; text-transform: uppercase; color: var(--muted); margin-bottom: 8px; }
    .desc-box p { font-size: 14px; color: #475569; line-height: 1.6; }

    .review-box { background: #fffef0; border: 1px solid #fde68a; border-radius: 20px; padding: 15px; margin-top: 20px; }
    .stars { color: #facc15; font-size: 16px; }

    .btn-zap { display: block; width: 100%; background: #25d366; color: white; text-align: center; padding: 20px; border-radius: 22px; text-decoration: none; font-weight: 900; font-size: 17px; margin-top: 20px; box-shadow: 0 10px 20px rgba(37, 211, 102, 0.2); }
  </style>
</head>
<body>

  <div class="header-nav">
    <a href="index.html" class="btn-back">‚Üê Voltar</a>
    <div id="pDist" class="distancia-top">Localizando...</div>
  </div>

  <div class="panel" id="mainPanel" style="display:none;">
    <div class="gallery"><img id="pImg" src="" alt="Foto"></div>
    
    <span id="pTipo" class="badge-tipo">--</span>
    <h1 id="pModelo">---</h1>
    <span class="price" id="pPreco">R$ ---</span>

    <div class="info-grid">
        <div class="info-box"><small>Marca</small><span id="pMarca">--</span></div>
        <div class="info-box"><small>Capacidade</small><span id="pCap">--</span></div>
        <div class="info-box"><small>Sa√∫de Bateria</small><span id="pBat">--</span>%</div>
        <div class="info-box"><small>Condi√ß√£o</small><span id="pCon">--</span></div>
    </div>

    <div class="desc-box" id="descContainer" style="display:none;">
        <h4>Sobre este aparelho</h4>
        <p id="pDesc">---</p>
    </div>

    <div class="review-box">
        <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ <small style="color:#a16207; font-size:10px; font-weight:700;">(Match Score RePhone)</small></div>
    </div>

    <a href="" id="pZap" target="_blank" class="btn-zap">CHAMAR NO WHATSAPP</a>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

    const firebaseConfig = { apiKey: "AIzaSyBiN8FqX8UZeyAh1cG2GHZtQWiQH0xPBV4", authDomain: "rephone-a0a80.firebaseapp.com", projectId: "rephone-a0a80", storageBucket: "rephone-a0a80.firebasestorage.app", messagingSenderId: "431497247030", appId: "1:431497247030:web:a943715e4acc04b8995b97" };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const id = new URLSearchParams(window.location.search).get('id');

    async function load() {
      if(!id) return;
      const snap = await getDoc(doc(db, "anuncios", id));
      if (snap.exists()) {
        const ad = snap.data();
        document.getElementById('pImg').src = ad.fotos[0];
        document.getElementById('pModelo').innerText = ad.modelo;
        document.getElementById('pPreco').innerText = `R$ ${ad.preco}`;
        document.getElementById('pMarca').innerText = ad.marca || 'Apple';
        document.getElementById('pCap').innerText = ad.capacidade;
        document.getElementById('pBat').innerText = ad.bateria;
        document.getElementById('pCon').innerText = ad.condicao;
        document.getElementById('pTipo').innerText = ad.tipo || 'Particular';
        document.getElementById('pZap').href = `https://wa.me/55${ad.whatsapp}?text=Vi o ${ad.modelo} no RePhone. Ainda est√° dispon√≠vel?`;
        
        // Exibir descri√ß√£o se existir
        if(ad.descricao) {
            document.getElementById('pDesc').innerText = ad.descricao;
            document.getElementById('descContainer').style.display = 'block';
        }

        const vSnap = await getDoc(doc(db, "vendedores", ad.uid));
        if (vSnap.exists() && vSnap.data().coords) calcDist(vSnap.data().coords);
        
        document.getElementById('mainPanel').style.display = 'block';
      }
    }

    function calcDist(vCoords) {
      navigator.geolocation.getCurrentPosition(pos => {
        const [la1, lo1] = vCoords.split(',').map(Number);
        const [la2, lo2] = [pos.coords.latitude, pos.coords.longitude];
        const R = 6371;
        const dLa = (la2-la1)*Math.PI/180; const dLo = (lo2-lo1)*Math.PI/180;
        const a = Math.sin(dLa/2)**2 + Math.cos(la1*Math.PI/180)*Math.cos(la2*Math.PI/180)*Math.sin(dLo/2)**2;
        const dist = R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        document.getElementById('pDist').innerText = `üìç A ${dist.toFixed(1)} km`;
      }, () => {
        document.getElementById('pDist').innerText = "üìç GPS Desligado";
      });
    }
    load();
  </script>
</body>
</html>
