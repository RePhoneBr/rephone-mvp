<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Anunciar | RePhone Aracruz</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --dark: #0f172a; --green: #16a34a; --gold: #d4af37; --bg: #f8fafc; --border: #e2e8f0; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: white; color: var(--dark); padding-bottom: 50px; }

        .header-venda { background: var(--dark); padding: 30px 20px; text-align: center; border-radius: 0 0 30px 30px; margin-bottom: 25px; }
        .logo-mini { background: linear-gradient(135deg, #fff, var(--gold)); color: var(--dark); width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-weight: 900; margin: 0 auto 10px; }
        
        .container { padding: 0 20px; }
        label { display: block; font-weight: 700; font-size: 11px; color: #64748b; text-transform: uppercase; margin: 15px 0 5px 5px; }
        
        input, select, textarea { 
            width: 100%; padding: 14px; border-radius: 12px; border: 1px solid var(--border); 
            background: var(--bg); font-size: 15px; outline: none; transition: 0.3s;
        }
        input:focus, textarea:focus { border-color: var(--green); background: white; }

        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

        /* Estilo das Fotos */
        .photo-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px; }
        .photo-slot { 
            background: var(--bg); border: 2px dashed #cbd5e1; border-radius: 15px; 
            aspect-ratio: 1/1; display: flex; flex-direction: column; align-items: center; 
            justify-content: center; text-align: center; cursor: pointer; position: relative;
        }
        .photo-slot.active { border: 2px solid var(--green); background: #f0fdf4; }
        .photo-slot span { font-size: 20px; }
        .photo-slot small { font-size: 9px; font-weight: 700; color: #64748b; margin-top: 4px; }
        .optional-badge { position: absolute; top: -5px; right: -5px; background: #94a3b8; color: white; font-size: 8px; padding: 2px 5px; border-radius: 4px; }

        .btn-submit { 
            background: var(--green); color: white; border: none; padding: 18px; 
            border-radius: 15px; width: 100%; font-weight: 800; font-size: 16px; margin-top: 30px;
            box-shadow: 0 10px 20px rgba(22, 163, 74, 0.2);
        }
    </style>
</head>
<body>

    <div class="header-venda">
        <div class="logo-mini">RP</div>
        <h1 style="color:white; font-size: 22px;">Novo An√∫ncio</h1>
        <p style="color:#94a3b8; font-size: 13px;">Preencha os detalhes do seu aparelho</p>
    </div>

    <div class="container">
      <form id="formVenda">
    <div class="grid-2">
        <div>
            <label>Marca</label>
            <select id="vMarca" required>
                <option value="Apple">Apple</option>
                <option value="Samsung">Samsung</option>
                <option value="Motorola">Motorola</option>
                <option value="Xiaomi">Xiaomi</option>
                <option value="Outra">Outra</option>
            </select>
        </div>
        <div>
            <label>Modelo exato</label>
            <input type="text" id="vModel" placeholder="Ex: iPhone 13 Pro" required>
        </div>
    </div>

    <div class="grid-2">
        <div>
            <label>Capacidade</label>
            <select id="vCap" required>
                <option value="64GB">64GB</option>
                <option value="128GB">128GB</option>
                <option value="256GB">256GB</option>
                <option value="512GB">512GB</option>
                <option value="1TB">1TB</option>
            </select>
        </div>
        <div>
            <label>Conex√£o</label>
            <select id="vNet">
                <option value="5G">5G</option>
                <option value="4G">4G</option>
            </select>
        </div>
    </div>
                  <label>Estado de Conserva√ß√£o</label>
            <select id="vCondition">
                <option value="Novo">üíé Novo (Lacrado)</option>
                <option value="Semi novo">‚ú® Semi novo (Impec√°vel)</option>
                <option value="Usado">üì± Usado (Marcas de uso)</option>
            </select>

            <div class="grid-2">
                <div>
                    <label>Valor (R$)</label>
                    <input type="number" id="vPrice" placeholder="0.00" required>
                </div>
                <div>
                    <label>Disponibilidade</label>
                    <select id="vStock" onchange="togglePrazo()">
                        <option value="Estoque">Em estoque</option>
                        <option value="Encomenda">Sob encomenda</option>
                    </select>
                </div>
            </div>

            <div id="areaPrazo">
                <label>Prazo de Entrega</label>
                <select id="vDelivery">
                    <option value="Imediato">Imediato (Aracruz)</option>
                    <option value="At√© 3 dias">At√© 3 dias</option>
                    <option value="At√© 7 dias">At√© 7 dias</option>
                    <option value="At√© 15 dias">At√© 15 dias</option>
                </select>
            </div>

            <label>Descri√ß√£o do Aparelho</label>
            <textarea id="vDesc" rows="4" required placeholder="insira informa√ß√µes importantes e detalhes de uso e marcas no aparelho"></textarea>

            <label>Fotos (M√≠nimo 2)</label>
            <div class="photo-row">
                <div class="photo-slot" id="slot1" onclick="document.getElementById('f1').click()">
                    <input type="file" id="f1" hidden accept="image/*" onchange="preview(1)" required>
                    <span>üì∏</span><small>Frente</small>
                </div>
                <div class="photo-slot" id="slot2" onclick="document.getElementById('f2').click()">
                    <input type="file" id="f2" hidden accept="image/*" onchange="preview(2)" required>
                    <span>üì±</span><small>Traseira</small>
                </div>
                <div class="photo-slot" id="slot3" onclick="document.getElementById('f3').click()">
                    <div class="optional-badge">Opcional</div>
                    <input type="file" id="f3" hidden accept="image/*" onchange="preview(3)">
                    <span>üîç</span><small>Detalhe</small>
                </div>
            </div>

            <button type="submit" id="btnEnviar" class="btn-submit">ENVIAR PARA CURADORIA</button>
        </form>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBiN8FqX8UZeyAh1cG2GHZtQWiQH0xPBV4",
            authDomain: "rephone-a0a80.firebaseapp.com",
            projectId: "rephone-a0a80",
            storageBucket: "rephone-a0a80.firebasestorage.app",
            messagingSenderId: "431497247030",
            appId: "1:431497247030:web:a943715e4acc04b8995b97"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const IMGBB_KEY = 'a4405be3b982f9aad88589728a3d949c';

        window.preview = (n) => {
            const slot = document.getElementById(`slot${n}`);
            slot.classList.add('active');
            slot.querySelector('small').innerText = "‚úì OK";
        };

        window.togglePrazo = () => {
            const stock = document.getElementById('vStock').value;
            // Se for estoque, geralmente √© imediato, mas deixamos o campo vis√≠vel para precis√£o
        };

        document.getElementById('formVenda').onsubmit = async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btnEnviar');
            btn.innerText = "ENVIANDO...";
            btn.disabled = true;

            try {
                const urls = [];
                for (let i = 1; i <= 3; i++) {
                    const file = document.getElementById(`f${i}`).files[0];
                    if (file) {
                        const fd = new FormData();
                        fd.append("image", file);
                        const res = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_KEY}`, { method: "POST", body: fd });
                        const data = await res.json();
                        urls.push(data.data.url);
                    }
                }

                await addDoc(collection(db, "anuncios"), {
                    marca: document.getElementById('vMarca').value,
                    modelo: document.getElementById('vModel').value,
                    capacidade: document.getElementById('vCap').value,
                    conexao: document.getElementById('vNet').value,
                    condicao: document.getElementById('vCondition').value,
                    preco: document.getElementById('vPrice').value,
                    estoque: document.getElementById('vStock').value,
                    prazo: document.getElementById('vDelivery').value,
                    descricao: document.getElementById('vDesc').value,
                    fotos: urls,
                    status: "pendente",
                    data: new Date()
                });

                alert("Aparelho enviado com sucesso!");
                window.location.href = "index.html";
            } catch (err) {
                alert("Erro ao enviar. Tente novamente.");
                btn.disabled = false;
                btn.innerText = "ENVIAR PARA CURADORIA";
            }
        };
    </script>
</body>
</html>
