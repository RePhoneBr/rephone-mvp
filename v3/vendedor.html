<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Novo Anúncio | RePhone</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #f8fafc; padding: 20px; }
        .card { background: white; padding: 20px; border-radius: 20px; max-width: 500px; margin: 0 auto; box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
        input, select, textarea { width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; border: 1px solid #e2e8f0; }
        button { width: 100%; background: #0f172a; color: white; padding: 15px; border-radius: 12px; border: none; font-weight: 800; cursor: pointer; }
    </style>
</head>
<body>
    <div class="card">
        <h2>O que você vai vender?</h2>
        <form id="formA">
            <select id="vTipo"><option>Particular</option><option>Lojista</option></select>
            <input type="text" id="vMarca" placeholder="Marca (Ex: Apple)" required>
            <input type="text" id="vModelo" placeholder="Modelo (Ex: iPhone 13 Pro)" required>
            <input type="text" id="vPrice" placeholder="Preço (Ex: 3.500)" required>
            <input type="text" id="vBat" placeholder="Saúde da Bateria %" required>
            <textarea id="vDesc" placeholder="Detalhes do aparelho..."></textarea>
            <input type="tel" id="vZap" placeholder="Seu WhatsApp (DDD+Número)" required>
            <label>Fotos:</label>
            <input type="file" id="vFotos" accept="image/*" multiple required>
            <button type="submit" id="btnS">PUBLICAR ANÚNCIO</button>
        </form>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";

        const firebaseConfig = { apiKey: "AIzaSyBiN8FqX8UZeyAh1cG2GHZtQWiQH0xPBV4", authDomain: "rephone-a0a80.firebaseapp.com", projectId: "rephone-a0a80", storageBucket: "rephone-a0a80.firebasestorage.app", messagingSenderId: "431497247030", appId: "1:431497247030:web:a943715e4acc04b8995b97" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const IMGBB_KEY = "a4405be3b982f9aad88589728a3d949c";

        let currentUid = "";
        onAuthStateChanged(auth, user => { if(!user) window.location.href="vendedor-login.html"; else currentUid = user.uid; });

        document.getElementById('formA').onsubmit = async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btnS');
            btn.innerText = "ENVIANDO FOTOS...";
            btn.disabled = true;

            const files = document.getElementById('vFotos').files;
            const urls = [];

            for (let file of files) {
                const formData = new FormData();
                formData.append("image", file);
                const res = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_KEY}`, { method: "POST", body: formData });
                const data = await res.json();
                urls.push(data.data.url);
            }

            await addDoc(collection(db, "anuncios"), {
                uid: currentUid,
                tipo: document.getElementById('vTipo').value,
                marca: document.getElementById('vMarca').value,
                modelo: document.getElementById('vModelo').value,
                preco: document.getElementById('vPrice').value,
                bateria: document.getElementById('vBat').value,
                descricao: document.getElementById('vDesc').value,
                whatsapp: document.getElementById('vZap').value,
                fotos: urls,
                status: "pendente",
                data: new Date()
            });
            alert("Enviado para curadoria!");
            window.location.href = "dashboard-vendedor.html";
        };
    </script>
</body>
</html>
