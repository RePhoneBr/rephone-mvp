<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Criar Conta | RePhone</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --dark: #0f172a; --green: #16a34a; --bg: #f8fafc; --muted: #64748b; }
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Inter', sans-serif; }
        body { background: var(--bg); height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .reg-card { background: white; width: 100%; max-width: 400px; padding: 40px 30px; border-radius: 30px; box-shadow: 0 20px 40px rgba(0,0,0,0.05); text-align: center; }
        h2 { font-weight: 900; font-size: 22px; margin-bottom: 10px; }
        p { color: var(--muted); font-size: 14px; margin-bottom: 25px; }
        label { display: block; text-align: left; font-size: 11px; font-weight: 800; text-transform: uppercase; color: var(--muted); margin-bottom: 5px; margin-left: 5px; }
        input { width: 100%; padding: 16px; border-radius: 15px; border: 1px solid #e2e8f0; background: #f8fafc; margin-bottom: 15px; outline: none; font-size: 15px; }
        .btn-reg { width: 100%; background: var(--green); color: white; padding: 18px; border-radius: 15px; border: none; font-weight: 800; cursor: pointer; margin-top: 10px; }
        .footer-links { margin-top: 25px; font-size: 13px; color: var(--muted); }
        .footer-links a { color: var(--dark); font-weight: 700; text-decoration: none; }
    </style>
</head>
<body>
    <div class="reg-card">
        <h2>Comece a Vender</h2>
        <p>Crie sua conta para publicar no Radar.</p>
        
        <label>E-mail</label>
        <input type="email" id="email" placeholder="seu@email.com">
        
        <label>WhatsApp (com DDD)</label>
        <input type="number" id="whatsapp" placeholder="Ex: 11999999999">
        
        <label>Senha</label>
        <input type="password" id="pass" placeholder="Mínimo 6 caracteres">
        
        <button class="btn-reg" id="btnReg" onclick="registrar()">CRIAR MINHA CONTA</button>
        
        <div class="footer-links">
            Já tem conta? <a href="vendedor-login.html">Fazer Login</a>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

        const firebaseConfig = { 
            apiKey: "AIzaSyBiN8FqX8UZeyAh1cG2GHZtQWiQH0xPBV4", 
            authDomain: "rephone-a0a80.firebaseapp.com", 
            projectId: "rephone-a0a80", 
            storageBucket: "rephone-a0a80.firebasestorage.app", 
            appId: "1:431497247030:web:a943715e4acc04b8995b97" 
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.registrar = async () => {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('pass').value;
            const zap = document.getElementById('whatsapp').value;
            const btn = document.getElementById('btnReg');

            if(!email || !pass || !zap) return alert("Preencha todos os campos.");
            if(pass.length < 6) return alert("A senha deve ter pelo menos 6 caracteres.");
            if(zap.length < 10) return alert("Digite um WhatsApp válido com DDD.");

            btn.disabled = true;
            btn.innerText = "CRIANDO CONTA...";

            try {
                // 1. Cria o usuário no Auth
                const userCredential = await createUserWithEmailAndPassword(auth, email, pass);
                const user = userCredential.user;

                // 2. Salva o perfil do vendedor no Firestore vinculando o UID
                await setDoc(doc(db, "vendedores", user.uid), {
                    email: email,
                    whatsapp: zap,
                    tipo: "particular",
                    dataRegistro: new Date()
                });

                alert("Conta criada com sucesso!");
                window.location.href = 'vendedor-anuncio.html';

            } catch (e) {
                console.error(e);
                alert("Erro ao criar conta. Verifique se o e-mail já está em uso.");
                btn.disabled = false;
                btn.innerText = "CRIAR MINHA CONTA";
            }
        };
    </script>
</body>
</html>
