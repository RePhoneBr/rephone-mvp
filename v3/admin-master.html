<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Curadoria | RePhone Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --dark: #0f172a; --gold: #d4af37; --green: #16a34a; --red: #ef4444; --bg: #020617; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: white; padding: 20px; }

        /* Navega√ß√£o */
        .admin-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .btn-voltar { background: #1e293b; color: white; border: 1px solid #334155; padding: 10px 18px; border-radius: 10px; text-decoration: none; font-size: 13px; font-weight: 700; transition: 0.3s; }
        .btn-voltar:hover { background: #334155; }

        h2 { font-weight: 900; font-size: 22px; color: var(--gold); }
        .status-badge { background: #1e293b; padding: 5px 12px; border-radius: 20px; font-size: 11px; font-weight: 800; border: 1px solid #334155; }

        /* Cards de An√∫ncio */
        .grid-pendentes { display: grid; gap: 20px; margin-top: 20px; }
        .card-adm { background: #1e293b; border-radius: 25px; padding: 20px; border: 1px solid #334155; position: relative; }
        
        .info-aparelho { margin-bottom: 15px; }
        .info-aparelho h3 { font-size: 18px; font-weight: 800; color: white; }
        .info-aparelho p { font-size: 13px; color: #94a3b8; margin-top: 5px; }

        /* Box do Vendedor */
        .vendedor-box { 
            background: rgba(15, 23, 42, 0.5); 
            border: 1px dashed var(--gold); 
            padding: 15px; 
            border-radius: 15px; 
            margin: 15px 0;
            font-size: 12px;
        }
        .vendedor-box b { color: var(--gold); text-transform: uppercase; font-size: 10px; display: block; margin-bottom: 5px; }

        /* Bot√µes de A√ß√£o */
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn-action { border: none; padding: 15px; border-radius: 12px; font-weight: 800; font-size: 13px; cursor: pointer; transition: 0.3s; }
        .btn-approve { background: var(--green); color: white; }
        .btn-reject { background: #334155; color: #94a3b8; }
        .btn-approve:hover { transform: scale(1.02); filter: brightness(1.1); }
        .btn-reject:hover { background: var(--red); color: white; }

        .vazio { text-align: center; padding: 50px; color: #475569; font-weight: 700; }
    </style>
</head>
<body>

    <div class="admin-nav">
        <a href="admin-hub.html" class="btn-voltar">‚Üê Painel Hub</a>
        <div class="status-badge">FILTRO: PENDENTES</div>
    </div>

    <header>
        <h2>Curadoria RePhone</h2>
        <p style="color: #64748b; font-size: 13px;">Analise os an√∫ncios e dados de localiza√ß√£o antes de publicar.</p>
    </header>

    <div id="listaPendentes" class="grid-pendentes">
        <div class="vazio">Buscando novos an√∫ncios...</div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
        import { getFirestore, collection, query, where, onSnapshot, updateDoc, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

        const firebaseConfig = { 
            apiKey: "AIzaSyBiN8FqX8UZeyAh1cG2GHZtQWiQH0xPBV4", 
            authDomain: "rephone-a0a80.firebaseapp.com", 
            projectId: "rephone-a0a80", 
            storageBucket: "rephone-a0a80.firebasestorage.app", 
            messagingSenderId: "431497247030", 
            appId: "1:431497247030:web:a943715e4acc04b8995b97" 
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Escutar an√∫ncios pendentes em tempo real
        const q = query(collection(db, "anuncios"), where("status", "==", "pendente"));
        
        onSnapshot(q, (snapshot) => {
            const container = document.getElementById('listaPendentes');
            if (snapshot.empty) {
                container.innerHTML = '<div class="vazio">Nenhum an√∫ncio aguardando aprova√ß√£o.</div>';
                return;
            }

            container.innerHTML = "";
            snapshot.forEach((item) => {
                const ad = item.data();
                const id = item.id;

                const card = document.createElement('div');
                card.className = 'card-adm';
                card.innerHTML = `
                    <div class="info-aparelho">
                        <h3>${ad.marca} ${ad.modelo}</h3>
                        <p>Pre√ßo: <b>R$ ${ad.preco}</b> | Bateria: ${ad.bateria || 'N/A'}</p>
                        <p style="font-style: italic;">"${ad.descricao}"</p>
                    </div>

                    <div class="vendedor-box">
                        <b>DADOS DO VENDEDOR (SEGURAN√áA):</b>
                        <span>Tipo: ${ad.tipo === 'Lojista' ? 'üè™ LOJA' : 'üë§ PARTICULAR'}</span><br>
                        <span>WhatsApp: ${ad.whatsapp}</span><br>
                        <span>Localiza√ß√£o GPS: <a href="https://www.google.com/maps?q=${ad.localizacao || ''}" target="_blank" style="color:var(--gold)">Ver no Mapa üìç</a></span>
                    </div>

                    <div class="btn-group">
                        <button class="btn-action btn-reject" onclick="rejeitarAnuncio('${id}')">RECUSAR</button>
                        <button class="btn-action btn-approve" onclick="aprovarAnuncio('${id}')">APROVAR NO RADAR</button>
                    </div>
                `;
                container.appendChild(card);
            });
        });

        // Fun√ß√µes de A√ß√£o
        window.aprovarAnuncio = async (id) => {
            try {
                const ref = doc(db, "anuncios", id);
                await updateDoc(ref, { status: "aprovado" });
                alert("An√∫ncio aprovado com sucesso!");
            } catch (e) { alert("Erro ao aprovar."); }
        };

        window.rejeitarAnuncio = async (id) => {
            if (confirm("Deseja realmente excluir permanentemente este an√∫ncio?")) {
                try {
                    await deleteDoc(doc(db, "anuncios", id));
                } catch (e) { alert("Erro ao excluir."); }
            }
        };

    </script>
</body>
</html>
